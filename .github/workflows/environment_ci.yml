name: Environment CI
on: [pull_request, release, workflow_dispatch]
jobs:
  run:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
        modlist:
          - 'pyanodons'
          - 'ultracube'
          - 'data/file3.csv'
    env:
      OS: ${{ matrix.os }}
    steps:
    - uses: actions/checkout@v4
    - name: Set up Python 3.13
      uses: actions/setup-python@v5
      with:
        python-version: '3.13'
    - name: Install pip
      run: python -m pip install --upgrade pip
    - name: Install Draftsman
      run: pip install .
    - name: Install factorio-mod-downloader
      run: pip install factorio-mod-downloader
    - name: Install mods
      run: factorio-mod-downloader \
        --headless \
        --file "./.github/workflows/environments/${{ matrix.modlist }}/mod-sources.txt" \
        --destination "./.github/workflows/environments/${{ matrix.modlist }}" \
        --ignore-overwrite
    - name: Run `draftsman update`
      run: draftsman -v --mods-path "./.github/workflows/environments/${{ matrix.modlist }}/mods" update
